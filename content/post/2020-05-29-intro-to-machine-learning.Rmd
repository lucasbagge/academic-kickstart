---
title: Intro to machine learning
author: Lucas Bagge
date: '2020-05-29'
slug: intro-to-machine-learning
categories:
  - bootstrap
  - k-fold
tags:
  - bootstrap
  - k-fold
subtitle: ''
summary: ''
authors: []
lastmod: '2020-05-29T21:38:25+02:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, 
                      echo = TRUE, dpi = 300, cache.lazy = FALSE,
                      tidy = "styler", fig.width = 8, fig.height = 5)
library(tidymodels)
library(skimr)
library(tibble)
library(dplyr)
library(tidyr)
library(magrittr)
library(readr)
library(quantmod)
library(tibbletime)
library(dplyr)
library(tidyr)
```

## INtroduktion

I denne serie af post vil jeg fokuser på nogle af de
grundlæggende begreber og metoder for Machine Learning.

Her vil jeg gennemgå **resampling metoder**. Vores oprindelig data er et sample, men vi vil gerne resample det for at checke dens kvalitet. Der er to metoder man kan gøre det på;
- Bootstrap.
- Cross-validation. 

Der er forskellige typer fejl man kan have som bestå af **tranings error** og **test error**. Der er forskel i de to typer fejl og hvis man ser dem på en graf vil deres udvikling også være forskellig.

Når vi vil forudsige noget så kan der opstå fejl og det er bias og varians. **Bias** er hvor langt fra er vi fra sandheden. Varians er hvordan estimater bevæger sig omkring sit gennemsnit.  

## Prediction error

Det er som jeg har forklaret bundet i hvordan vores data kan indhoolde eror i dens komponenter, som vi skal håndterer.

## Validation set - approach

Med denne metode deler vi data op i to dele; **trænings sæt** og **validering sæt**. Her skal man fitte modeleln til sit trænignssæt og bruge det til at forudsige observationerne i validering sættet. De error vi får vil være et estimat for test error. Det er altså en opdelingaf vores data og modsat af hvordan man gør cross validation, som jeg kommer til senere. 

Med denne metode kan vi risiker at for meget upræcise test eror fordi modellen kommer til at være meget afhængig af hvad man indsætter som trænings og validering. 

## Cross validation

Denne metode bruges som validation til ast beregne test error. Med disse estimater kan vi finde den bedste model. Ideen er vi deleter data op i K lige store dele. Her efterlader vi delen k, fitter modellen til K-1 og hermed opnår prediction. Der foregår i forskellig trin, så vi starter med et valideingsæt og så skiftes den ud med de andre sample.  

Jeg viser en uddybning og hvordan man kan bruge cross validation i r. Her skal vi bruger
noget data, hvor vi tager udgangspunk i noget finansiel data. 

```{r}
start <- as.Date("2000-01-01")
end <- as.Date("2019-01-01")

getSymbols("AAPL", src = "yahoo", from = start, to = end)
tail(AAPL)
```

For at fortsætte skal vi lave noget yderligere featur enginering for at lave noget
input og output variabler.

- Input har jeg valgt skal være (open-close)/open, (high - low)/low, sd af de sidste
5 dages afkast og gennemsnittet af de 5 dages afkast.
- Output skal indikere om man vil købe aktien. Hvis i morgen lukke pris
er større end i dags så skal output variablen være 1 og -1 ellers for at indikere
man ikke skal købe den. 

Disse feature valg er random valgt, men hvis man vil dykke længere ned i det
kan man læse mere her https://en.wikipedia.org/wiki/Feature_selection.
```{r}
aaple <- tidy(AAPL)
rolling_mean_5 <- rollify(mean, window = 5)
rolling_sd_5 <- rollify(sd, window = 5)

ap <- aaple %>% 
  pivot_wider(
    names_from = series,
    values_from = value
    ) %>% 
  rename_all(tolower) %>% 
  mutate(Open_Close = (aapl.open - aapl.close) / aapl.open,
         High_low = (aapl.high - aapl.low) / aapl.low,
         percent = (aapl.close - lead(aapl.close)) / lead(aapl.close) * 100,
         ret_5 = rolling_mean_5(percent),
         sd_5 = rolling_sd_5(percent)) %>% 
  drop_na()

X <- ap %>% 
  select(Open_Close, High_low, ret_5, sd_5)

Y <-  1
```

https://blog.quantinsti.com/cross-validation-machine-learning-trading-models/
